<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Consuming JS data - Elmish</title> <link rel="shortcut icon" href="/purescript-elmish/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/purescript-elmish/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/purescript-elmish/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/purescript-elmish/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Consuming JS data | Elmish</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Consuming JS data" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Elmish is a PureScript UI library that (loosely) follows The Elm Architecture implemented as a thin layer on top of React." /> <meta property="og:description" content="Elmish is a PureScript UI library that (loosely) follows The Elm Architecture implemented as a thin layer on top of React." /> <link rel="canonical" href="/purescript-elmish/read-foreign/" /> <meta property="og:url" content="/purescript-elmish/read-foreign/" /> <meta property="og:site_name" content="Elmish" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Consuming JS data" /> <script type="application/ld+json"> {"description":"Elmish is a PureScript UI library that (loosely) follows The Elm Architecture implemented as a thin layer on top of React.","headline":"Consuming JS data","@type":"WebPage","url":"/purescript-elmish/read-foreign/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/purescript-elmish/" class="site-title lh-tight"> Elmish </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/purescript-elmish/" class="nav-list-link">Intro</a></li><li class="nav-list-item"><a href="/purescript-elmish/getting-started/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="/purescript-elmish/transition/" class="nav-list-link">State Transitions</a></li><li class="nav-list-item"><a href="/purescript-elmish/composition/" class="nav-list-link">Composition</a></li><li class="nav-list-item"><a href="/purescript-elmish/dom-elements/" class="nav-list-link">Rendering HTML</a></li><li class="nav-list-item active"><a href="/purescript-elmish/read-foreign/" class="nav-list-link active">Consuming JS data</a></li><li class="nav-list-item"><a href="/purescript-elmish/react-ffi/" class="nav-list-link">Using React components</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Elmish" aria-label="Search Elmish" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <blockquote> <p><strong>Under construction</strong>. This page is unfinished. Many headings just have some bullet points sketching the main points that should be discussed.</p> </blockquote> <h1 class="no_toc" id="consuming-js-data"> <a href="#consuming-js-data" class="anchor-heading" aria-labelledby="consuming-js-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consuming JS data </h1> <p>Elmish is explicitly built on top of React and does not try to hide this fact behind a higher-level abstraction. Elmish embraces React. This lets us leverage the ecosystem, but also comes with certain difficulties as we’re forced to pass data to and from JavaScript code, and JavaScript code can be very liberal with data shapes.</p> <p>To make this data exchange saner and safer, Elmish provides a mechanism for data shape validation.</p> <h2 id="taking-js-data-as-input"> <a href="#taking-js-data-as-input" class="anchor-heading" aria-labelledby="taking-js-data-as-input"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Taking JS data as input </h2> <p>If you’re looking at a data structure you just got from some JavaScript code, represented as a <code class="language-plaintext highlighter-rouge">Foreign</code> of course (can’t make assumptions, can we?), you can use the <code class="language-plaintext highlighter-rouge">readForeign</code> function to see if it has the right shape:</p> <div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">import</span> <span class="nn">Elmish.Foreign</span> <span class="p">(</span><span class="nf">readForeign</span><span class="p">)</span>

<span class="kr">type</span> <span class="kt">MyData</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">::</span> <span class="p">{</span> <span class="n">y</span> <span class="o">::</span> <span class="kt">Int</span> <span class="p">},</span> <span class="n">z</span> <span class="o">::</span> <span class="kt">String</span> <span class="p">}</span>

<span class="n">callMeFromJavaScript</span> <span class="o">::</span> <span class="kt">Foreign</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">callMeFromJavaScript</span> <span class="n">f</span> <span class="o">=</span>
  <span class="kr">case</span> <span class="n">readForeign</span> <span class="n">f</span> <span class="o">::</span> <span class="kt">Maybe</span> <span class="kt">MyData</span> <span class="kr">of</span>
    <span class="kt">Nothing</span> <span class="o">-&gt;</span> <span class="s">"Incoming data has the wrong shape"</span>
    <span class="kt">Just</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="s">"Got the right data: x.y = "</span> <span class="o">&lt;&gt;</span> <span class="n">show</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;&gt;</span> <span class="s">", z = "</span> <span class="o">&lt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">readForeign</code> will return <code class="language-plaintext highlighter-rouge">Nothing</code> if the value doesn’t conform to the expected type, or <code class="language-plaintext highlighter-rouge">Just a</code> if it does, where <code class="language-plaintext highlighter-rouge">a</code> has the right type.</p> <p class="callout"><strong>NOTE</strong> <code class="language-plaintext highlighter-rouge">readForeign</code> doesn’t actually <em>convert</em> the data structure. It only traverses it and makes sure that it has the right shape.</p> <p>This strategy turns out to be orders of magnitude faster than parsing with something like <code class="language-plaintext highlighter-rouge">purescript-argonaut</code>, which lets use it at all kinds of ingest boundaries, such as:</p> <ul> <li>Network API calls</li> <li>Top-level entry points</li> <li>Event handlers</li> <li>etc.</li> </ul> <p>The example above uses the <code class="language-plaintext highlighter-rouge">readForeign</code> function, which returns a <code class="language-plaintext highlighter-rouge">Maybe</code>, but it also has a big brother <code class="language-plaintext highlighter-rouge">readForeign'</code> (note the prime), which returns an <code class="language-plaintext highlighter-rouge">Either</code>, providing an error message about what exactly is incorrect with the data:</p> <div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">callMeFromJavaScript</span> <span class="o">::</span> <span class="kt">Foreign</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">callMeFromJavaScript</span> <span class="n">f</span> <span class="o">=</span>
  <span class="kr">case</span> <span class="n">readForeign'</span> <span class="n">f</span> <span class="o">::</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kt">MyData</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="n">err</span> <span class="o">-&gt;</span> <span class="s">"Oops: "</span> <span class="o">&lt;&gt;</span> <span class="n">err</span>
    <span class="kt">Right</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="s">"Got the right data: x.y = "</span> <span class="o">&lt;&gt;</span> <span class="n">show</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;&gt;</span> <span class="s">", z = "</span> <span class="o">&lt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span>
</code></pre></div></div> <p><strong>NOTE</strong>: We’re using type wildcards (underscores) so we don’t have to write <code class="language-plaintext highlighter-rouge">Either String</code> every time.</p> <h2 id="primitive-types-only"> <a href="#primitive-types-only" class="anchor-heading" aria-labelledby="primitive-types-only"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Primitive types only </h2> <p>The fact that <code class="language-plaintext highlighter-rouge">readForeign</code> doesn’t actually convert data has an important corollary: the data structure cannot contain any types that do not have straightforward JavaScript representation.</p> <p>For example, <code class="language-plaintext highlighter-rouge">String</code> is fine, and so it <code class="language-plaintext highlighter-rouge">Array String</code>, but <code class="language-plaintext highlighter-rouge">Maybe String</code> is not allowed, and neither is <code class="language-plaintext highlighter-rouge">Either String Int</code>.</p> <p>This is by design. The idea behind this mechanism is to enable <em>type safety</em>, which is not the same as <em>data marshalling</em>, although the two are frequently conflated. In any given situation marshalling may or may not be appropriate. If it is, it can be done separately, in combination with <code class="language-plaintext highlighter-rouge">readForeign</code> or instead of it. If no marshalling is required, <code class="language-plaintext highlighter-rouge">readForeign</code> is much smaller and more performant.</p> <h2 id="passing-data-out"> <a href="#passing-data-out" class="anchor-heading" aria-labelledby="passing-data-out"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Passing data out </h2> <ul> <li>Want to protect from accidentally passing PureScript data</li> <li>So have a type-class</li> <li>Compile-time only, zero-cost runtime</li> </ul> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2018-2022 CollegeVine</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
